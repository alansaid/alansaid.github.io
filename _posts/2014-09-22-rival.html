---
status: publish
published: true
title: RiVal - A tookit for recommender system benchmarking
excerpt: "A toolkit for recsys evaluation"
date: '2014-09-22 15:53:05 +0200'
date_gmt: '2014-09-22 13:53:05 +0200'
teaser: /images/2014-rival/flow-web.png
categories: [software, recsys]
---
<p>Recently, together with <a title="A. Bellog&iacute;n" href="http://ir.ii.uam.es/~alejandro/" target="_blank">Alejandro Bellog&iacute;n</a>, we released a t<a title="RiVal" href="http://rival.recommenders.net" target="_blank">oolkit for recommender system evaluation and benchmarking</a>. We wanted to create an objective, transparent, and portable setting for evaluating recommender systems. Why you might say? Well, we had a feeling this would be a good thing.</p>
<h3>Background</h3><br />
<p>
In 2013, both Alejandro and me found ourselves at <a title="CWI" href="http://www.cwi.nl" target="_blank">CWI</a> as <a title="ERCIM ABCDE" href="http://fellowship.ercim.eu" target="_blank">Marie Curie fellows</a>. Given the topics of our (then, quite recent) <a title="AB Diss" href="http://ir.ii.uam.es/~alejandro/thesis/" target="_blank">respective</a> <a title="AS Diss" href="http://opus4.kobv.de/opus4-tuberlin/frontdoor/index/index/docId/3681" target="_blank">dissertations</a>, we naturally started looking into different aspects of evaluation of recommender systems. One of these was how the evaluation performed in different frameworks (e.g. <a title="MyMediaLite" href="http://www.mymedialite.net" target="_blank">MyMediaLite</a> or <a title="Apache Mahout" href="http://mahout.apache.org" target="_blank">Apache Mahout</a>) compared to one-another. This started as a thought experiment while I was finalizing a book chapter on <a title="Benchmarking" href="http://dx.doi.org/10.1007/978-3-642-45135-5_11" target="_blank">Benchmarking</a> together with <a title="Domonkos Tikk" href="http://scholar.google.com/citations?user=8xw5-oIAAAAJ&amp;hl=en" target="_blank">Domonkos Tikk</a> and <a title="Paolo Cremonesi" href="http://www.deib.polimi.it/personale/dettagliop.php?id_persona=159156&amp;idlang=eng" target="_blank">Paolo Cremonesi</a>. For this chapter, I put together a list of recommendation frameworks (below). Together with Alejandro, we thought it would be interesting to see how some of these frameworks compared to each other when using the same datasets, evaluation settings, and overall setup.</p>
<p><img class="size-medium wp-image-1406" src="/images/2014-rival/frameworks-bw.png" alt="Common frameworks used for recommendation" width="300" height="190" /> Common frameworks used for recommendation</p>
<p><a id="more"></a><a id="more-1398"></a></p>
<p>This led to us sitting down and writing a lot of code over a few months in order to be able to run different frameworks and benchmark them against each other using a separate evaluation tool. We started by adding support for <a title="LensKit" href="http://lenskit.org" target="_blank">Lenskit</a> and Mahout as they are both written in Java, the language we selected for our toolkit. We also added some support for MyMediaLite through bash scripts. After much coding, we had a standalone toolkit which does not need to be aware of how and where the recommendations are generated, as long as it gets access to a predictions file and an evaluation file. We christened the toolkit <a title="RiVal" href="http://rival.recommenders.net/" target="_blank">RiVal</a> and started running benchmarks.</p>

<h3>Setup</h3><br />
<p>
An evaluation setup in RiVal consists of three steps; split, candidate items generation, evaluation. Each of the steps is configurable so as to make sure that the toolkit can be used in many contexts, and to provide objective evaluations. The split step handles the data splitting, i.e. what portion of the dataset used is going to end up in a training set and what portion will end up in a test set. The step is configurable through a strategy, a strategy can be e.g. random, time-aware, ratio (80-20, 90-10, etc.). The candidate items generation step specifies which items/users will actually be evaluated, i.e whether all users should exist in both training and test set (user-based), or correspondingly all items should exist in both training and test sets, or whether a certain relevance threshold should be used when selecting items into the test set (item-based).</p>
<p><img class="wp-image-1410 size-medium" src="/images/2014-rival/flow-web.png" alt="RiVal pipeline" width="300" height="139" />RiVal pipeline</p>
<p>The final step, the evaluation, is the only step which is mandatory, is where the evaluation metrics which will be used are selected and calculated. As input, the process requires a validation set and the recommendations generated by the recommender. The split and candidate items steps can be skipped if the dataset splitting process is internal to recommendation framework. Doing this will however not allow for the same kind of fine-grained control of the evaluation and benchmarking process as the whole pipeline allows.</p>

<h3>Evaluating Lenskit, Mahout and MyMediaLite</h3><br />
<p>
Coming back to our initial idea of comparing the same algorithms in different frameworks, we decided to compare three very common algorithms implemented in Lenskit, MyMediaLite and Mahout, namely Item-based Collaborative Filtering, User-based Collaborative Filtering&nbsp;(k-nearest neighbors) and Matrix Factorization (FunkSVD and SVD++). We focused on comparing not only the recommendation accuracy, but also the (item and user) coverage of the recommendations, and the time needed for the framework to recommend.</p>
<p>Since no SVD factorization method is implemented in all three frameworks, we used FunkSVD in Mahout and Lenskit, and SVD++ in MyMediaLite - this obviously reflects on the results.</p>
<p>For each algorithm, we ran evaluation on the <a title="Movielens 100k" href="http://files.grouplens.org/datasets/movielens/ml-100k-README.txt" target="_blank">Movielens 100k</a> dataset, using two different training/test splits: cross-validation (cv), and per-user ratio (rt), and three different values for k (for k-nearest neighbor and latent factors in SVD): 10, 50, and the square root of the number of items in the training set.</p>
<p>Below are the results for different metrics used in our evaluation.</p>
<p>Keys to column labels: AM = Apache Mahout; LK = Lenskit; MML = MyMediaLite; gl = global; pu = per user; cv = cross validation; rt = ratio.</p>
<p>Keys to row labels: UB = User-based; Pea = Pearson Correlation; Cos = Cosine similarity; IB = Item-based.</p>
<p><img class="size-medium wp-image-1412" src="/images/2014-rival/heatmap_time.png" alt="Time spent on recommending" width="300" height="207" /> Time spent on recommending</p>
<p>Above, we see,&nbsp; not unexpectedly, that the running time of the algorithms differs. Specifically, MyMediaLite appears to be generally a little slower than the other frameworks. It should be noted that all experiments were run on two identical workstations running Fedora Linux. Since MyMediaLite is written in C#, it was run using the Mono framework.</p>
<p><img class="size-medium wp-image-1413" src="/images/2014-rival/catalog_coverage_landscape.png" alt="Catalog coverage" width="300" height="62" /> Catalog coverage</p>
<p>When it comes to catalog coverage, i.e. the fraction of items in the training set that are actually being recommended, we again see that the three frameworks perform differently. Mahout and MyMediaLite appear to have problems achieving high coverage (note blue color indicates low coverage).</p>
<p><img class="size-medium wp-image-1416" src="/images/2014-rival/user_coverage_landscape.png" alt="User coverage" width="300" height="62" /> User coverage</p>
<p>Similarly, when looking at user coverage, Mahout again appears to have problems when it comes to recommending to all users. This is likely based on the fact that Mahout will only recommend to users that have at minimum a predefined number of items (two times the number of items to be recommended).</p>
<p><img class="size-medium wp-image-1414" src="/images/2014-rival/ndcg_cut_10_landscape.png" alt="NDCG" width="300" height="62" /> NDCG</p>
<p>Perhaps most interesting is the figure depicting more traditional recommendation accuracy, i.e. nDCG in the figure above. Should the three frameworks perform similarly, the colors on each row should not change. What we see is that the framework perform widely differently from each other. MyMediaLite seems to generally outperform the others. However, taking into consideration the coverage issues in the figures above this does not necessarily mean that MyMediaLite is the "best" of the frameworks.</p>

<h3>So, what does this mean for me?</h3><br />
<p>
Well, provided that you are a recommender systems practitioner or researcher, you might be interested in using RiVal. Or at the very least making sure that you look at your results in the right context. A direct comparison of your algorithm's performance to something you read in a paper or online might not be feasible. Only compare your performance within the same framework, on the same data and the same <strong>data splits</strong>. You can also, obviously, use RiVal in your work ;)</p>
<h3>Where do I get RiVal?</h3><br />
<p>
The toolkit is available on <a title="RiVal" href="http://github.com/recommenders/rival" target="_blank">Github</a> and in <a title="RiVal Maven" href="http://search.maven.org/#artifactdetails|net.recommenders.rival|rival|0.1|jar" target="_blank">Maven repositories</a>. You'll likely want to check out the <a title="RiVal" href="http://rival.recommenders.net/" target="_blank">project website </a>for more information.</p>
<h3>Where do I read more about this?</h3></p>
<ul>
<li><em>A. Said, A. Bellog&iacute;n</em>. <a title="RiVal paper" href="http://files.alans.se/papers/2014-recsys-benchmarking.pdf" target="_blank">Comparative Recommender System Evaluation: Benchmarking Recommendation Frameworks</a>. ACM RecSys 2014.</li>
<li><em>A. Said, A. Bellog&iacute;n</em>. <a title="RiVal demo" href="http://files.alans.se/papers/2014-recsys-rival.pdf" target="_blank">RiVal - A Toolkit to Foster Reproducibility in Recommender System Evaluation</a>. ACM RecSys 2014.</li><br />
</ul></p>
